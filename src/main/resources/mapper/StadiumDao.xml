<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.digitalchina.sport.order.api.dao.StadiumDao" >
    <!-- 获取精选主场馆 -->
    <select id="getAllSpecialStadium" resultType="java.util.HashMap">
         SELECT m.id,name,address,lng,lat,s.pic_address FROM main_stadium m LEFT JOIN stadium_pic s ON m.id=s.stadium_id WHERE m.is_special='1' AND s.is_first='1'
    </select>
    <!-- 查询所有场馆列表且根据用户当前距离排序 -->
    <select id="findAllStadiumList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
          A.name,
          A.address,
          B.distance
        FROM (SELECT A.*,
        ROUND(6378.138*2*asin(sqrt(pow(sin( (lat*pi()/180-${clientLat}*pi()/180)/2),2)+cos(lat*pi()/180)*cos(${clientLat}*pi()/180)* pow(sin( (lng*pi()/180-${clientLng}*pi()/180)/2),2)))*1000) + "" AS distance
        FROM (SELECT
          ms.name,
          ms.address
        FROM
        `main_stadium ms`
        WHERE
        <![CDATA[CAST(Lon AS DECIMAL(19, 12)) < ${maxLng}
		AND CAST(Lon AS DECIMAL(19, 12)) > ${minLng}
		AND CAST(Lat AS DECIMAL(19, 12)) < ${maxLat}
		AND CAST(Lat AS DECIMAL(19, 12)) > ${minLat}]]>
        ) A
        ORDER BY distance ASC) B
    </select>
    <!-- 根据ID查询会馆详情 -->
    <select id="findStadiumDetailById" parameterType="java.lang.String" resultType="com.digitalchina.sport.order.api.model.MainStadium">
        SELECT
          ms.id,
          ms.name,
          ms.provincialLevel,
          ms.cityLevel,
          ms.
        FROM main_stadium ms WHERE ms.id = #{Id}
    </select>

    <!-- 根据子场馆ID获得子场馆和所属父场馆详情 -->
    <select id="getStadiumDetail" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
            m.`name` AS mname,
            m.address,
            m.telephone,
            m.`status` AS mstatus,
            s.classify,
            s.id AS sid,
            s.parent_id as pid,
            s.`name` AS sname,
            s.`status` AS sstatus
        FROM
            sub_stadium s
        LEFT JOIN main_stadium m ON s.parent_id = m.id
        WHERE
            s.id = #{stadiumId}
    </select>
    <!-- 根据场馆ID获取场馆图片列表 -->
    <select id="getAllPictureByStadiumId" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    SELECT
        pic.id,pic.pic_address,pic.is_first,pic.stadium_id,pic.create_time
    FROM
        stadium_pic pic
    WHERE
        pic.stadium_id = #{stadiumId}
    </select>
</mapper>